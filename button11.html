<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>버튼 트리 기록 앱</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body{margin:0;padding:10px;background:#f5f5f5;font-family:system-ui}
.app{max-width:900px;margin:auto;background:#fff;border-radius:12px;padding:12px}
button{border:1px solid #ddd;border-radius:8px;padding:6px 10px;background:#fff;cursor:pointer}
button:disabled{opacity:.5}
.btn-main{width:100%;text-align:left;padding:10px;margin-bottom:6px}
</style>
</head>
<body>

<div class="app">
  <h2>버튼 트리 기록 앱 <small id="mode">로딩중…</small></h2>

  <div>
    <button id="loginBtn">Google 로그인</button>
    <button id="logoutBtn" disabled>로그아웃</button>
    <span id="status">로그인 안 됨</span>
  </div>

  <hr />

  <div id="buttons"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

<script>
/* Firebase 설정 */
firebase.initializeApp({
  apiKey: "AIzaSyC8kLsUhGLu4eGhTYlKlh-tKCQkKjF0EvU",
  authDomain: "button-tree.firebaseapp.com",
  projectId: "button-tree"
});
const auth = firebase.auth();
const db = firebase.firestore();
const provider = new firebase.auth.GoogleAuthProvider();

let tree = null;
let user = null;

/* 기본 트리 */
function defaultTree(){
  return {
    id:"root",
    children:[
      {id:"a1",label:"기상",children:[]},
      {id:"a2",label:"책상정리",children:[]}
    ]
  };
}

/* 렌더 */
function render(){
  const box = document.getElementById("buttons");
  box.innerHTML = "";
  tree.children.forEach(n=>{
    const b=document.createElement("button");
    b.className="btn-main";
    b.textContent=n.label;
    box.appendChild(b);
  });
}

/* 로그인 상태 */
auth.onAuthStateChanged(async u=>{
  user=u;
  document.getElementById("loginBtn").disabled=!!u;
  document.getElementById("logoutBtn").disabled=!u;
  document.getElementById("status").textContent =
    u ? "로그인됨" : "로그인 안 됨";

  if(!u) return;

  document.getElementById("mode").textContent="클라우드 모드";

  const ref=db.collection("users").doc(u.uid);
  const snap=await ref.get();

  if(snap.exists){
    tree=snap.data().tree;
  }else{
    tree=defaultTree();
    await ref.set({tree});
  }

  render();
});

/* 버튼 */
loginBtn.onclick=()=>auth.signInWithPopup(provider);
logoutBtn.onclick=()=>auth.signOut();
</script>
</body>
</html>
